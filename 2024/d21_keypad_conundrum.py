import aoc

NUM_PAD = ['789',
           '456',
           '123',
           ' 0A']
NUM_C_TO_ARROWS = {
    '7': {
        '7': [''], '8': ['>'], '9': ['>>'],
        '4': ['v'], '5': ['>v', 'v>'], '6': ['>>v', '>v>', 'v>>'],
        '1': ['vv'], '2': ['>vv', 'v>v', 'vv>'], '3': ['>>vv', '>v>v', '>vv>', 'v>>v', 'v>v>', 'vv>>'],
        '0': ['>vvv', 'v>vv', 'vv>v'], 'A': ['>>vvv', '>v>vv', '>vv>v', '>vvv>', 'v>>vv', 'v>v>v', 'v>vv>', 'vv>>v', 'vv>v>']
    },
    '8': {
        '7': ['<'], '8': [''], '9': ['>'],
        '4': ['<v', 'v<'], '5': ['v'], '6': ['>v', 'v>'],
        '1': ['<vv', 'v<v', 'vv<'], '2': ['vv'], '3': ['>vv', 'v>v', 'vv>'],
        '0': ['vvv'], 'A': ['>vvv', 'v>vv', 'vv>v', 'vvv>']
    },
    '9': {
        '7': ['<<'], '8': ['<'], '9': [''],
        '4': ['<<v', '<v<', 'v<<'], '5': ['<v', 'v<'], '6': ['v'],
        '1': ['<<vv', '<v<v', '<vv<', 'v<<v', 'v<v<', 'vv<<'], '2': ['<vv', 'v<v', 'vv<'], '3': ['vv'],
        '0': ['<vvv', 'v<vv', 'vv<v', 'vvv<'], 'A': ['vvv']
    },
    '4': {
        '7': ['^'], '8': ['>^', '^>'], '9': ['>>^', '>^>', '^>>'],
        '4': [''], '5': ['>'], '6': ['>>'],
        '1': ['v'], '2': ['>v', 'v>'], '3': ['>>v', '>v>', 'v>>'],
        '0': ['>vv', 'v>v'], 'A': ['>>vv', '>v>v', '>vv>', 'v>>v', 'v>v>']
    },
    '5': {
        '7': ['<^', '^<'], '8': ['^'], '9': ['>^', '^>'],
        '4': ['<'], '5': [''], '6': ['>'],
        '1': ['<v', 'v<'], '2': ['v'], '3': ['>v', 'v>'],
        '0': ['vv'], 'A': ['>vv', 'v>v', 'vv>']
    },
    '6': {
        '7': ['<<^', '<^<', '^<<'], '8': ['<^', '^<'], '9': ['^'],
        '4': ['<<'], '5': ['<'], '6': [''],
        '1': ['<<v', '<v<', 'v<<'], '2': ['<v', 'v<'], '3': ['v'],
        '0': ['<vv', 'v<v', 'vv<'], 'A': ['vv']
    },
    '1': {
        '7': ['^^'], '8': ['>^^', '^>^', '^^>'], '9': ['>>^^', '>^>^', '>^^>', '^>>^', '^>^>', '^^>>'],
        '4': ['^'], '5': ['>^', '^>'], '6': ['>>^', '>^>', '^>>'],
        '1': [''], '2': ['>'], '3': ['>>'],
        '0': ['>v'], 'A': ['>>v', '>v>']
    },
    '2': {
        '7': ['<^^', '^<^', '^^<'], '8': ['^^'], '9': ['>^^', '^>^', '^^>'],
        '4': ['<^', '^<'], '5': ['^'], '6': ['>^', '^>'],
        '1': ['<'], '2': [''], '3': ['>'],
        '0': ['v'], 'A': ['>v', 'v>']
    },
    '3': {
        '7': ['<<^^', '<^<^', '<^^<', '^<<^', '^<^<', '^^<<'], '8': ['<^^', '^<^', '^^<'], '9': ['^^'],
        '4': ['<<^', '<^<', '^<<'], '5': ['<^', '^<'], '6': ['^'],
        '1': ['<<'], '2': ['<'], '3': [''],
        '0': ['<v', 'v<'], 'A': ['v']
    },
    '0': {
        '7': ['^<^^', '^^<^', '^^^<'], '8': ['^^^'], '9': ['>^^^', '^>^^', '^^>^', '^^^>'],
        '4': ['^<^', '^^<'], '5': ['^^'], '6': ['>^^', '^>^', '^^>'],
        '1': ['^<'], '2': ['^'], '3': ['>^', '^>'],
        '0': [''], 'A': ['>']
    },
    'A': {
        '7': ['<^<^^', '<^^<^', '<^^^<', '^<<^^', '^<^<^', '^<^^<', '^^<<^', '^^<^<', '^^^<<'], '8': ['<^^^', '^<^^', '^^<^', '^^^<'], '9': ['^^^'],
        '4': ['<^<^', '<^^<', '^<<^', '^<^<', '^^<<'], '5': ['<^^', '^<^', '^^<'], '6': ['^^'],
        '1': ['<^<', '^<<'], '2': ['<^', '^<'], '3': ['^'],
        '0': ['<'], 'A': ['']
    }
}

KEY_PAD = [' ^A',
           '<v>']
KEY_C_TO_ARROWS = {
    '^': {
        '^': [''], 'A': ['>'],
        '<': ['v<'], 'v': ['v'], '>': ['>v', 'v>']
    },
    'A': {
        '^': ['<'], 'A': [''],
        '<': ['<v<', 'v<<'], 'v': ['<v', 'v<'], '>': ['v']
    },
    '<': {
        '^': ['>^'], 'A': ['>>^', '>^>'],
        '<': [''], 'v': ['>'], '>': ['>>']
    },
    'v': {
        '^': ['^'], 'A': ['>^', '^>'],
        '<': ['<'], 'v': [''], '>': ['>']
    },
    '>': {
        '^': ['<^', '^<'], 'A': ['^'],
        '<': ['<<'], 'v': ['<'], '>': ['']
    }
}


def get_answer(lines, part):
    codes = lines

    answer = 0
    for code in codes:
        sequences_key2 = translate_sequences([code], NUM_C_TO_ARROWS)
        sequences_key1 = translate_sequences(sequences_key2, KEY_C_TO_ARROWS)
        sequences_key0 = translate_sequences(sequences_key1, KEY_C_TO_ARROWS)
        sequence_min = min(sequences_key0, key=len)
        answer += len(sequence_min) * int(code[:3])
    return answer


def translate_sequences(sequences, c_to_arrows):
    translations = list()
    for sequence in sequences:
        seq_translations = ['']
        c_aiming = 'A'
        for c in sequence:
            seq_translations_next = list()
            for seq_translation in seq_translations:
                for arrows in c_to_arrows[c_aiming][c]:
                    seq_translations_next.append(seq_translation + arrows + 'A')
            seq_translations = seq_translations_next
            c_aiming = c
        translations.extend(seq_translations)
    return translations


if __name__ == '__main__':
    aoc.solve(21, get_answer)
